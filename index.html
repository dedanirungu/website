<html>
<body>
  <div id="app">
    <router-view></router-view>
  </div>
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://unpkg.com/vue-router@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue3-sfc-loader"></script>

  <script>

    const { loadModule } = window['vue3-sfc-loader'];

    const options = {

      moduleCache: {
        vue: Vue
      },

      getFile(path) {

        return fetch(path).then(res => res.ok ? res.text() : Promise.reject(res));
      },

      addStyle(textContent) {

        const style = Object.assign(document.createElement('style'), { textContent });
        const ref = document.head.getElementsByTagName('style')[0] || null;
        document.head.insertBefore(style, ref);
      },
    }

    const fetchTag = (tag_name) => {
      return Vue.defineAsyncComponent( () => loadModule('tags/' + tag_name + '/index.vue', options) )
    }

    const fetchWebsite = (tag_name) => {
      return Vue.defineAsyncComponent( () => loadModule('./' + tag_name, options) )
    }



    // 2. Define some routes
    // Each route should map to a component.
    // We'll talk about nested routes later.
    const routes = [
      { path: '/', component: fetchWebsite('website.vue') },
      { path: '/about', component: fetchWebsite('website.vue') },
    ]

    // 3. Create the router instance and pass the `routes` option
    // You can pass in additional options here, but let's
    // keep it simple for now.
    const router = VueRouter.createRouter({
      // 4. Provide the history implementation to use. We are using the hash history for simplicity here.
      history: VueRouter.createWebHistory('/'),
      //history: VueRouter.createWebHashHistory(),
      //mode: 'history',
      routes, // short for `routes: routes`
    })


    const app = Vue.createApp({});

    app.use(router)

    app.mount('#app');

  </script>
  
</body>
</html>